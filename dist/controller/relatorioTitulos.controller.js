sap.ui.define(["application/controller/BaseController","sap/m/MessageBox","application/model/formatter","sap/ui/core/mvc/Controller","sap/m/TablePersoController","sap/ui/core/util/Export","sap/ui/core/util/ExportTypeCSV","sap/ui/model/json/JSONModel"],function(e,t,o){"use strict";var i=[];return e.extend("application.controller.relatorioTitulos",{onInit:function(){this.getRouter().getRoute("relatorioTitulos").attachPatternMatched(this._onLoadFields,this)},onItemChange2:function(e){var t=e.getParameters().from;var o=e.getParameters().to;var i=[];var r=[new sap.ui.model.Filter("zfbdt",sap.ui.model.FilterOperator.BT,t,o)];var a=new sap.ui.model.Filter(r,false);i.push(a);this.byId("idtableTitulos").getBinding("items").filter(i,sap.ui.model.FilterType.Application)},onItemChange:function(e){var t=this.byId("idClientesRelatorio").getValue();var o=[];var i=[new sap.ui.model.Filter("kunnr",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("name1",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("status",sap.ui.model.FilterOperator.Contains,t)];var r=new sap.ui.model.Filter(i,false);o.push(r);this.byId("idtableTitulos").getBinding("items").filter(o,sap.ui.model.FilterType.Application)},_onLoadFields:function(){var e=this;var o=[];var r=[];var a=[];i=[];var n=indexedDB.open("VB_DataBase");n.onerror=function(){t.show(n.error.mensage,{icon:t.Icon.ERROR,title:"Banco n√£o encontrado!",actions:[t.Action.OK]})};n.onsuccess=function(){var t=n.result;var i=t.transaction("TitulosAbertos").objectStore("TitulosAbertos");i.getAll().onsuccess=function(i){r=i.target.result;var a=t.transaction("Clientes").objectStore("Clientes");a.openCursor().onsuccess=function(t){var i=t.target.result;if(i){o.push(i.value);i.continue()}else{var a=new Date;for(var n=0;n<r.length;n++){for(var s=0;s<o.length;s++){if(r[n].kunnr==o[s].kunnr){r[n].NomeCliente=o[s].NomeAbrev;if(r[n].zfbdt<a){r[n].status="Vencido";r[n].pathImg=sap.ui.require.toUrl("application/img/R.png")}else{r[n].status="Aberto";r[n].pathImg=sap.ui.require.toUrl("application/img/S.png")}}}}var l=new sap.ui.model.json.JSONModel(r);e.getView().setModel(l,"TitulosAbertos");e.byId("idtableTitulos").setBusy(false);var u=e.getOwnerComponent().getModel("modelAux").getProperty("/Kunnr");if(u!=""){e.byId("idClientesRelatorio").setValue(u);e.onItemChange()}}}}}}})});