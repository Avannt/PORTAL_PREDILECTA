sap.ui.define(["application/controller/BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/routing/History"],function(e,o,t,r){"use strict";return e.extend("application.controller.produtoConsultas",{onInit:function(){this.getRouter().getRoute("produtoConsultas").attachPatternMatched(this._onCreateModel,this)},_onCreateModel:function(){var e=this;var o=[];e.vetorTodosPrecos=[];this.byId("idTabelaPreco").setSelectedKey();var t=new sap.ui.model.json.JSONModel;this.getView().setModel(t,"consultasProdutos");var r=indexedDB.open("VB_DataBase");r.onerror=function(){console.log(r.error.mensage)};r.onsuccess=function(){var t=r.result;var s=t.transaction("A963","readonly").objectStore("A963");if("getAll"in s){s.getAll().onsuccess=function(t){var r=[];r=t.target.result;for(var s=0;s<r.length;s++){if(r[s].pltyp!="AM"&&r[s].pltyp!="BD"&&r[s].pltyp!="BO"){o.push(r[s])}}var a=new sap.ui.model.json.JSONModel(o);e.getView().setModel(a,"tabPreco")}}}},onNavBack:function(){sap.ui.core.UIComponent.getRouterFor(this).navTo("menuConsultas")},onPressDetailBack:function(){this.byId("list").removeSelections(true);this.getSplitContObj().backDetail()},onChangeTabelaPreco:function(e){var o=this;this.byId("tableProdutos").setBusy(true);var t=e.getSource().getSelectedKey();var r=this.getOwnerComponent().getModel("modelAux").getProperty("/Werks");var s=o.getOwnerComponent().getModel("modelAux").getProperty("/Usuario").tabbri;var a=o.getOwnerComponent().getModel("modelAux").getProperty("/Usuario").tabamo;var n=o.getOwnerComponent().getModel("modelAux").getProperty("/Usuario").tabbon;var l=indexedDB.open("VB_DataBase");l.onerror=function(){console.log(l.error.mensage)};l.onsuccess=function(){var e=l.result;var r=new Promise(function(o,t){var r=e.transaction("Materiais","readonly").objectStore("Materiais");if("getAll"in r){r.getAll().onsuccess=function(e){var t=[];t=e.target.result;o(t)}}});r.then(function(r){var l=[];var i="";var u="";var c=e.transaction("A960","readwrite");var d=c.objectStore("A960");var p=d.index("pltyp");var v=p.getAll(t);v.onsuccess=function(e){o.vetorTodosPrecos=e.target.result;var i=p.getAll(s);i.onsuccess=function(e){var s=e.target.result;for(var i=0;i<s.length;i++){o.vetorTodosPrecos.push(s[i])}var u=p.getAll(a);u.onsuccess=function(e){var s=e.target.result;for(var a=0;a<s.length;a++){o.vetorTodosPrecos.push(s[a])}var i=p.getAll(n);i.onsuccess=function(e){var s=e.target.result;for(var a=0;a<s.length;a++){o.vetorTodosPrecos.push(s[a])}for(var n=0;n<r.length;n++){o.byId("tableProdutos").setBusy(true);for(var i=0;i<o.vetorTodosPrecos.length;i++){if(r[n].mtpos=="YBRI"&&o.vetorTodosPrecos[i].pltyp=="BD"&&r[n].matnr==o.vetorTodosPrecos[i].matnr){r[n].zzVprod=o.vetorTodosPrecos[i].zzVprod;l.push(r[n]);break}else if(r[n].mtpos=="YBON"&&o.vetorTodosPrecos[i].pltyp=="BO"&&r[n].matnr==o.vetorTodosPrecos[i].matnr){r[n].zzVprod=o.vetorTodosPrecos[i].zzVprod;l.push(r[n]);break}else if(r[n].mtpos=="YAMO"&&o.vetorTodosPrecos[i].pltyp=="AM"&&r[n].matnr==o.vetorTodosPrecos[i].matnr){r[n].zzVprod=o.vetorTodosPrecos[i].zzVprod;l.push(r[n]);break}else if(r[n].mtpos=="NORM"&&o.vetorTodosPrecos[i].pltyp==t&&r[n].matnr==o.vetorTodosPrecos[i].matnr){r[n].zzVprod=o.vetorTodosPrecos[i].zzVprod;l.push(r[n]);break}}}var u=new sap.ui.model.json.JSONModel(l);o.getView().setModel(u,"consultasProdutos");o.byId("tableProdutos").setBusy(false)}}}}})}},onSearch:function(e){var o=e.getSource().getValue();var t=[];var r=[new sap.ui.model.Filter("matnr",sap.ui.model.FilterOperator.StartsWith,o),new sap.ui.model.Filter("maktx",sap.ui.model.FilterOperator.Contains,o)];var s=new sap.ui.model.Filter(r,false);t.push(s);this.byId("tableProdutos").getBinding("items").filter(t,"Application")},onPressModeBtn:function(e){var o=e.getSource().getSelectedButton().getCustomData()[0].getValue();this.getSplitContObj().setMode(o)},getSplitContObj:function(){var e=this.byId("SplitContDemoProdutos");if(!e){o.sap.log.error("SplitApp object can't be found")}return e}})});