sap.ui.define(["application/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History"],function(e,t,o){"use strict";return e.extend("application.controller.clienteConsultasDetalhe",{onInit:function(e){this.getRouter().getRoute("clienteConsultasDetalhe").attachPatternMatched(this._onLoadFields,this)},onAfterRendering:function(){},onNavBack:function(e){var t,r;t=o.getInstance();r=t.getPreviousHash();if(r!==undefined){window.history.go(-1)}else{this.getRouter().navTo("clienteConsultas",{},true)}},_onLoadFields:function(){var e=this;this.byId("idTopLevelIconTabBar").setSelectedKey("tab1");var o=this.getOwnerComponent().getModel("modelCliente").getProperty("/codigoCliente");var r=e.getModelGlobal("modelAux").getProperty("/CodRepres");e.oModel=e.getModelGlobal("modelAux").getProperty("/DBModel");e.vetorCliente=[];e.vetorTbPreco=[];new Promise(function(t,l){e.oModel.read("/ClienteR(IvUsuario='"+r+"',IvCliente='"+o+"')",{success:function(e){t(e)},error:function(e){l(e)}})}).then(function(l){e.vetorCliente=l;var s=new t(e.vetorCliente);e.setModel(s,"modelCliente");var n=new t(e.vetorTbPreco);e.setModel(n,"modelTbPreco");new Promise(function(t,o){var r="1";var l=e.getModel("modelCliente").getProperty("/Kunnr");e.onBuscarClienteEmpresa(l,r,t,o,e)}).then(function(l){e.getModel("modelCliente").setProperty("/Kvgr1",l.Kvgr1);e.getModel("modelCliente").setProperty("/DescKvgr1",l.DescKvgr1);e.getModel("modelCliente").setProperty("/Kvgr2",l.Kvgr2);e.getModel("modelCliente").setProperty("/DescKvgr2",l.DescKvgr2);e.getModel("modelCliente").setProperty("/Kvgr3",l.Kvgr3);e.getModel("modelCliente").setProperty("/DescKvgr3",l.DescKvgr3);e.getModel("modelCliente").setProperty("/Kvgr4",l.Kvgr4);e.getModel("modelCliente").setProperty("/DescKvgr4",l.DescKvgr4);e.getModel("modelCliente").setProperty("/Kvgr5",l.Kvgr5);e.getModel("modelCliente").setProperty("/DescKvgr5",l.DescKvgr5);e.getModel("modelCliente").setProperty("/Bzirk",l.Bzirk);e.getModel("modelCliente").setProperty("/Pltyp",l.Pltyp);e.getModel("modelCliente").setProperty("/Inco1",l.Inco1);var s={Kunnr:l.Kunnr,Name1:l.Name1,Pltyp:l.Pltyp,Ptext:l.DescPltyp};e.vetorTbPreco.push(s);e.getModel("modelTbPreco").setData(e.vetorTbPreco);e.byId("table_ContratosAtivos").setBusy(true);e.oModel.read("/Contratos",{urlParameters:{$filter:"IvUsuario eq '"+r+"' and IvCliente eq '"+o+"'"},success:function(o){e.vetorContratosTotal=o.results;var r=e.getModel("modelCliente").getProperty("/Kvgr4");e.vetorContratos=e.vetorContratosTotal.filter(function(e){if(e.Kvgr4==r){return e}});var l=new t(e.vetorContratos);e.setModel(l,"modelContratos");e.byId("table_ContratosAtivos").setBusy(false)},error:function(t){e.onMensagemErroODATA(t);e.byId("table_ContratosAtivos").setBusy(false)}});e.oModel.read("/TitulosAbertos",{urlParameters:{$filter:"IvUsuario eq '"+r+"'"},success:function(o){e.vetorTitulosTotal=o.results;var r=e.getModel("modelCliente").getProperty("/Kunnr");e.vetorTitulos=e.vetorTitulosTotal.filter(function(e){if(e.Kunnr==r){return e}});var l=new t(e.vetorTitulos);e.setModel(l,"modelTitulos");e.vetorTitulosTotal=[];var s=new t(e.vetorTitulosTotal);e.setModel(s,"modelTitulosTotal");var n=0;for(var a=0;a<e.vetorTitulos.length;a++){var i=false;for(var u=0;u<e.vetorTitulosTotal.length;u++){if(e.vetorTitulos[a].Bukrs==e.vetorTitulosTotal[u].Bukrs){i=true;e.vetorTitulosTotal[u].ValTotal=parseFloat(e.vetorTitulosTotal[u].ValTotal)+Math.round(parseFloat(e.vetorTitulos[a].Dmbtr)*100)/100;e.vetorTitulosTotal[u].ValTotal=parseFloat(e.vetorTitulosTotal[u].ValTotal).toFixed(2)}}if(i==false){var v={Bukrs:e.vetorTitulos[a].Bukrs,Butxt:e.vetorTitulos[a].Butxt,ValTotal:parseFloat(e.vetorTitulos[a].Dmbtr)};e.vetorTitulosTotal.push(v)}n+=parseFloat(e.vetorTitulos[a].ValTotal)}e.getModel("modelTitulosTotal").setData(e.vetorTitulosTotal)},error:function(t){e.onMensagemErroODATA(t)}})}).catch(function(t){e.onMensagemErroODATA(t)})}).catch(function(t){e.onMensagemErroODATA(t)})}})});
//# sourceMappingURL=clienteConsultasDetalhe.controller.js.map