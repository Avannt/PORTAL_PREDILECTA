sap.ui.define(["application/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History"],function(e,t,o){"use strict";return e.extend("application.controller.clienteConsultasDetalhe",{onInit:function(e){this.getRouter().getRoute("clienteConsultasDetalhe").attachPatternMatched(this._onLoadFields,this)},onAfterRendering:function(){},onNavBack:function(e){var t,r;t=o.getInstance();r=t.getPreviousHash();if(r!==undefined){window.history.go(-1)}else{this.getRouter().navTo("clienteConsultas",{},true)}},_onLoadFields:function(){var e=this;this.byId("idTopLevelIconTabBar").setSelectedKey("tab1");var o=this.getOwnerComponent().getModel("modelCliente").getProperty("/codigoCliente");var r=e.getModelGlobal("modelAux").getProperty("/CodRepres");e.oModel=e.getModelGlobal("modelAux").getProperty("/DBModel");e.vetorCliente=[];e.vetorTbPreco=[];e.oModel.read("/ClienteR(IvUsuario='"+r+"',IvCliente='"+o+"')",{success:function(o){e.vetorCliente=o;var r=new t(e.vetorCliente);e.setModel(r,"modelCliente");var l=new t(e.vetorTbPreco);e.setModel(l,"modelTbPreco");var a={Kunnr:o.Kunnr,Name1:o.Name1,Pltyp:o.Pltyp,Ptext:o.DescPltyp};e.vetorTbPreco.push(a);e.getModel("modelTbPreco").setData(e.vetorTbPreco)},error:function(t){e.onMensagemErroODATA(t)}});e.oModel.read("/Contratos",{urlParameters:{$filter:"IvUsuario eq '"+r+"'"},success:function(o){var r=o.results;var l=new t(r);e.setModel(l,"modelContratos")},error:function(t){e.onMensagemErroODATA(t)}});e.oModel.read("/TitulosAbertos",{urlParameters:{$filter:"IvUsuario eq '"+r+"'"},success:function(o){e.vetorTitulosTotal=o.results;var r=e.getModel("modelCliente").getProperty("/Kunnr");e.vetorTitulos=e.vetorTitulosTotal.filter(function(e){if(e.Kunnr==r){return e}});var l=new t(e.vetorTitulos);e.setModel(l,"modelTitulos");e.vetorTitulosTotal=[];var a=new t(e.vetorTitulosTotal);e.setModel(a,"modelTitulosTotal");var s=0;for(var n=0;n<e.vetorTitulos.length;n++){var i=false;for(var u=0;u<e.vetorTitulosTotal.length;u++){if(e.vetorTitulos[n].Bukrs==e.vetorTitulosTotal[u].Bukrs){i=true;e.vetorTitulosTotal[u].ValTotal=parseFloat(e.vetorTitulosTotal[u].ValTotal)+Math.round(parseFloat(e.vetorTitulos[n].Dmbtr)*100)/100;e.vetorTitulosTotal[u].ValTotal=parseFloat(e.vetorTitulosTotal[u].ValTotal).toFixed(2)}}if(i==false){var T={Bukrs:e.vetorTitulos[n].Bukrs,Butxt:e.vetorTitulos[n].Butxt,ValTotal:parseFloat(e.vetorTitulos[n].Dmbtr)};e.vetorTitulosTotal.push(T)}s+=parseFloat(e.vetorTitulos[n].ValTotal)}e.getModel("modelTitulosTotal").setData(e.vetorTitulosTotal)},error:function(t){e.onMensagemErroODATA(t)}})}})});