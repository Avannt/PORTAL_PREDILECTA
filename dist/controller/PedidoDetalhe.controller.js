sap.ui.define(["application/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageBox","application/model/formatter"],function(e,o,t,a){"use strict";return e.extend("application.controller.PedidoDetalhe",{formatter:a,onInit:function(){this.getRouter().getRoute("pedidoDetalhe").attachPatternMatched(this.onLoadFields,this)},onLoadFields:function(){var e=this;var o=e.getModelGlobal("modelAux").getProperty("/NrPedido");e.byId("idPedidoDetalhe").setBusy(true);new Promise(function(o,t){e.onInicializaCampos(o,t)}).then(function(){if(o!=""){new Promise(function(t,a){e.onBuscarPedido(o,t,a,e)}).then(function(o){e.getModelGlobal("modelPedido").setData(o);e.onCarregarTipoPedido(o.Werks);e.onCarregarCombosMsgPedido(o);e.byId("idPedidoDetalhe").setBusy(false);new Promise(function(o,t){e.onBuscarItensPedido(o,t,e.getModelGlobal("modelAux").getProperty("/NrPedido"))}).then(function(t){e.vetorItensPedido=t;e.getModelGlobal("modelItensPedidoGrid").setData(e.vetorItensPedido);e.getModelGlobal("modelItensPedidoGrid").refresh();e.getModelGlobal("modelAux").setProperty("/ItensPedidoTab",e.vetorItensPedido.length);e.byId("table_pedidos").setBusy(false);e.onBloquearPedido(o.IdStatusPedido)}).catch(function(o){e.byId("table_pedidos").setBusy(false);e.onMensagemErroODATA(o)})}).catch(function(o){e.byId("table_pedidos").setBusy(false);e.onMensagemErroODATA(o)})}else{e.onCriarNrPedido();e.onSetValuesDefault();e.onBloquearPedido(e.getModelGlobal("modelPedido").getProperty("IdStatusPedido"));e.byId("idPedidoDetalhe").setBusy(false)}})},onInicializaCampos:function(e,t){var a=this;a.oModel=this.getModelGlobal("modelAux").getProperty("/DBModel");a.CodRepres=this.getModelGlobal("modelAux").getProperty("/CodRepres");a.Usuario=this.getModelGlobal("modelAux").getProperty("/Usuario");this.byId("idVencimento1").setEnabled(true);a.vetorFretes=[];a.vetorCentros=[];a.vetorCampanha=[];a.vetorProdutos=[];a.vetorTabPrecos=[];a.vetorMsgPedido=[];a.vetorContratos=[];a.vetorMsgPedido2=[];a.vetorMsgPedido3=[];a.vetorTipoPedidos=[];a.vetorItensPedido=[];a.vetorMotivosNota=[];a.vetorVencimentos1=[];a.vetorMotivosBoleto=[];a.vetorLocaisEntregas=[];a.vetorMotivosCampanha=[];a.vetorVencimentoTotal=[];a.vetorTipoPedidosTotal=[];a.getModelGlobal("modelAux").getProperty("/ObrigaSalvar",false);a.getModelGlobal("modelAux").getProperty("/ItensPedidoTab",0);var d=a.getModelGlobal("Cliente_G");a.setModel(d,"modelCliente");var s=new o(a.vetorContratos);a.setModel(s,"modelContratos");var i=new o(a.vetorVencimentos1);a.setModel(i,"modelVencimentos1");var r=new o(a.vetorCampanha);a.setModel(r,"modelCampanha");var l=new o(a.vetorTabPrecos);a.setModel(l,"modelTabPrecos");var n=new o(a.vetorFretes);a.setModel(n,"modelFretes");var c=new o(a.vetorCentros);a.setModel(c,"modelCentros");var m=new o(a.vetorTipoPedidos);a.setModel(m,"modelTipoPedidos");var b=new o(a.vetorMsgPedido);a.setModel(b,"modelMsgPedido");var P=new o(a.vetorMsgPedido2);a.setModel(P,"modelMsgPedido2");var g=new o(a.vetorMsgPedido3);a.setModel(g,"modelMsgPedido3");var p=new o(a.vetorLocaisEntregas);a.setModel(p,"modelLocaisEntregas");var u=new o(a.vetorProdutos);a.setModelGlobal(u,"modelProdutos");var y=new o(a.vetorMotivosCampanha);a.setModelGlobal(y,"modelMotivosCamp");var h=new o(a.vetorMotivosNota);a.setModelGlobal(h,"modelMotivosNota");var I=new o(a.vetorMotivosBoleto);a.setModelGlobal(I,"modelMotivosBoleto");var M=new o(a.vetorItensPedido);a.setModelGlobal(M,"modelItensPedidoGrid");a.byId("idTopLevelIconTabBar").setSelectedKey("tab1");a.onCriarModelPedido();var v=[];v.push(new Promise(function(e,o){a.oModel.read("/Vencimentos",{success:function(o){a.vetorVencimentoTotal=o.results;a.getModel("modelVencimentos1").setData(a.vetorVencimentoTotal);e()},error:function(e){a.onMensagemErroODATA(e)}})}));v.push(new Promise(function(e,o){a.oModel.read("/TabPrecos",{success:function(o){for(var t=0;t<o.results.length;t++){if(o.results[t].Pltyp==a.getModel("modelCliente").getProperty("/Pltyp")){a.vetorTabPrecos.push(o.results[t])}}a.getModel("modelTabPrecos").setData(a.vetorTabPrecos);e()},error:function(e){a.onMensagemErroODATA(e)}})}));v.push(new Promise(function(e,o){a.oModel.read("/MsgNF",{success:function(o){a.vetorMsgPedido=o.results;a.getModel("modelMsgPedido").setData(a.vetorMsgPedido);e()},error:function(e){a.onMensagemErroODATA(e)}})}));v.push(new Promise(function(e,o){a.oModel.read("/LocaisEntregas",{urlParameters:{$filter:"IvUsuario eq '"+a.Usuario+"'"},success:function(o){var t=o.results;for(var d=0;d<t.length;d++){var s=t[d];if(s.Kunnr==a.getModel("modelCliente").getProperty("/Kunnr")){a.vetorLocaisEntregas.push(s)}}a.getModel("modelLocaisEntregas").setData(a.vetorLocaisEntregas);e()},error:function(e){a.onMensagemErroODATA(e)}})}));v.push(new Promise(function(e,o){a.oModel.read("/Fretes",{success:function(o){a.vetorFretes=o.results;a.getModel("modelFretes").setData(a.vetorFretes);e()},error:function(e){a.onMensagemErroODATA(e)}})}));v.push(new Promise(function(e,o){a.oModel.read("/TipoPedidos",{urlParameters:{$filter:"IvUsuario eq '"+a.Usuario+"'"},success:function(o){var t=o.results;for(var d=0;d<t.length;d++){if(t[d].Kunnr==a.getModel("modelCliente").getProperty("/Kunnr")){a.vetorTipoPedidosTotal.push(t[d])}}e()},error:function(e){a.onMensagemErroODATA(e)}})}));v.push(new Promise(function(e,t){a.oModel.read("/Centros",{urlParameters:{$filter:"IvUsuario eq '"+a.Usuario+"'"},success:function(t){a.vetorCentros=t.results;c=new o(a.vetorCentros);a.setModel(c,"modelCentros");e()},error:function(e){t(e)}})}));v.push(new Promise(function(e,o){a.vetorMotivosCampanha=[];a.vetorMotivosBoleto=[];a.vetorMotivosNota=[];a.oModel.read("/MotvCamp",{success:function(o){var t=o.results;for(var d=0;d<t.length;d++){var s=t[d];if(s.TipoDesconto=="CAMP"){a.vetorMotivosCampanha.push(s)}else if(s.TipoDesconto=="BOL"){a.vetorMotivosBoleto.push(s)}else if(s.TipoDesconto=="NF"){a.vetorMotivosNota.push(s)}}a.getModelGlobal("modelMotivosCamp").setData(a.vetorMotivosCampanha);a.getModelGlobal("modelMotivosBoleto").setData(a.vetorMotivosBoleto);a.getModelGlobal("modelMotivosNota").setData(a.vetorMotivosNota);e()},error:function(e){o();a.onMensagemErroODATA(e)}})}));v.push(new Promise(function(e,o){var t=a.getModelGlobal("modelAux").getProperty("/CodRepres");a.oModel.read("/TipoIntegraBol",{urlParameters:{$filter:"IvUsuario eq '"+a.Usuario+"'"},success:function(o){var t=o.results;var d=a.getModel("modelCliente").getProperty("/Kunnr");var s=a.getModel("modelPedido").getProperty("/Bukrs");var i="false";for(var r=0;r<t.length;r++){if(d==t[r].Kunnr&&s==t[r].Bukrs){i="true";break}}if(i=="true"){a.getModelGlobal("modelPedido").setProperty("/TipoIntegrBol","CONTAS A RECEBER")}else{a.getModelGlobal("modelPedido").setProperty("/TipoIntegrBol","CONTAS A PAGAR")}e()},error:function(e){o();a.onMensagemErroODATA(e)}})}));Promise.all(v).then(function(o){a.getModelGlobal("modelPedido").setProperty("/EmailCliente",a.getModel("modelCliente").getProperty("/EmailComprador"));e()})},onValidaDataMenorAtual:function(e){var o=e.split("/");var t=this.onDataHora();var a=t[2].ano+t[2].mes+t[2].dia;var d=String(o[2])+String(o[1])+String(o[0]);if(d>=a){return"Data OK"}else{return"Data menor que data atual!"}},onCarregarCombosMsgPedido:function(e){var o=this.getModel("modelMsgPedido").getData();if(e.MsgPedido1!=""&&e.MsgPedido1!="00000"){for(var t=0;t<o.length;t++){if(o[t].CodMensagem!=e.MsgPedido1){this.vetorMsgPedido2.push(o[t])}}this.getModel("modelMsgPedido2").setData(this.vetorMsgPedido2)}if(e.MsgPedido2!="00000"&&e.MsgPedido2!=""){for(var t=0;t<this.vetorMsgPedido2.length;t++){if(this.vetorMsgPedido2[t].CodMensagem!=e.MsgPedido2){this.vetorMsgPedido3.push(this.vetorMsgPedido2[t])}}this.getModel("modelMsgPedido3").setData(this.vetorMsgPedido3)}},onSetValuesDefault:function(){var e=this.onDataHora();this.getModelGlobal("modelPedido").setProperty("/SituacaoPedido","EM DIGITAÇÃO");this.getModelGlobal("modelPedido").setProperty("/IdStatusPedido",1);this.getModelGlobal("modelPedido").setProperty("/TipoDispositivo","PORTALWEB");this.getModelGlobal("modelPedido").setProperty("/Lifnr",this.getModel("modelAux").getProperty("/Lifnr"));this.getModelGlobal("modelPedido").setProperty("/Usuario",this.getModel("modelAux").getProperty("/Usuario"));this.getModelGlobal("modelPedido").setProperty("/DataIni",e[0]);this.getModelGlobal("modelPedido").setProperty("/HoraIni",e[1]);this.getModelGlobal("modelPedido").setProperty("/DataFim",e[0]);this.getModelGlobal("modelPedido").setProperty("/HoraFim",e[1]);this.getModelGlobal("modelPedido").setProperty("/Kunnr",this.getModel("modelCliente").getProperty("/Kunnr"));this.getModelGlobal("modelPedido").setProperty("/Kvgr1",this.getModel("modelCliente").getProperty("/Kvgr1"));this.getModelGlobal("modelPedido").setProperty("/Kvgr2",this.getModel("modelCliente").getProperty("/Kvgr2"));this.getModelGlobal("modelPedido").setProperty("/Kvgr3",this.getModel("modelCliente").getProperty("/Kvgr3"));this.getModelGlobal("modelPedido").setProperty("/Kvgr4",this.getModel("modelCliente").getProperty("/Kvgr4"));this.getModelGlobal("modelPedido").setProperty("/Kvgr5",this.getModel("modelCliente").getProperty("/Kvgr5"));this.getModelGlobal("modelPedido").setProperty("/Bzirk",this.getModel("modelCliente").getProperty("/Bzirk"));this.getModelGlobal("modelPedido").setProperty("/Txjcd",this.getModel("modelCliente").getProperty("/Txjcd"));this.getModelGlobal("modelPedido").setProperty("/Pltyp",this.getModel("modelCliente").getProperty("/Pltyp"));this.getModelGlobal("modelPedido").setProperty("/EmailRepres",this.getModelGlobal("modelAux").getProperty("/Email"));this.getModel("modelPedido").setProperty("/Tdt",this.getModel("modelCliente").getProperty("/Tdt"));this.getModel("modelPedido").setProperty("/EmailCliente",this.getModel("modelCliente").getProperty("/EmailComprador"));if(this.getModel("modelCliente").getProperty("/Inco1")!=""){this.getModel("modelPedido").setProperty("/Inco1",this.getModel("modelCliente").getProperty("/Inco1"))}},onBloquearPedido:function(e){var o=this;function t(e,t,a){o.byId("idEstabelecimento").setEnabled(e);o.byId("idTabelaPreco").setEnabled(e);if(o.getModelGlobal("modelPedido").getProperty("/Contrato")!=""){o.byId("idVencimento1").setEnabled(false)}else{o.byId("idVencimento1").setEnabled(e)}o.byId("idTipoPedido").setEnabled(e);o.byId("idLocalEntrega").setEnabled(e);o.byId("idTipoTransporte").setEnabled(e);o.byId("idEmailCliente").setEnabled(e);if(t==3||t==2){o.byId("idDataLimite").setEnabled(false);o.byId("idDataEntrega").setEnabled(false);o.byId("idMsg1").setEnabled(false);o.byId("idMsg2").setEnabled(false);o.byId("idMsg3").setEnabled(false);o.byId("idPedidoOrigem").setEnabled(false);o.byId("idObservacoes").setEnabled(false)}else{o.byId("idDataLimite").setEnabled(true);o.byId("idDataEntrega").setEnabled(true);o.byId("idMsg1").setEnabled(true);o.byId("idMsg2").setEnabled(true);o.byId("idMsg3").setEnabled(true);o.byId("idPedidoOrigem").setEnabled(true);o.byId("idObservacoes").setEnabled(true)}if(t!=1){o.byId("idDescontoPedido").setEnabled(false);o.byId("idDescontoAplicar").setEnabled(false);o.byId("idDescontoAplicarBoleto").setEnabled(false);o.byId("idDescontoPedidoCamp").setEnabled(false);o.byId("idDescontoAplicarCamp").setEnabled(false);o.byId("idDescontoPedidoBoleto").setEnabled(false);o.byId("idDescontoPedidoCampBol").setEnabled(false);o.byId("idDescontoAplicarCampBol").setEnabled(false)}else{o.byId("idDescontoPedido").setEnabled(true);o.byId("idDescontoAplicar").setEnabled(true);o.byId("idDescontoAplicarBoleto").setEnabled(true);o.byId("idDescontoPedidoCamp").setEnabled(true);o.byId("idDescontoAplicarCamp").setEnabled(true);o.byId("idDescontoPedidoBoleto").setEnabled(true);o.byId("idDescontoPedidoCampBol").setEnabled(true);o.byId("idDescontoAplicarCampBol").setEnabled(true)}}function a(e){o.byId("tabTotalStep").setEnabled(e);o.byId("tabDescontoStep").setEnabled(e);o.byId("tabItensPedidoStep").setEnabled(e)}var d=this.getModelGlobal("modelItensPedidoGrid").getData();if(d.length>0&&e==1){t(false,e);a(true)}else if(d.length==0){t(true,e);a(false)}else if(e==3||e==2){t(false,e);a(true)}},onCriarNrPedido:function(){this.byId("idTopLevelIconTabBar").setSelectedKey("tab1");this.getModelGlobal("modelPedido").setProperty("/Completo",false);var e=this.getModelGlobal("modelAux").getProperty("/CodRepres");var o=this.getModelGlobal("modelAux").getProperty("/Lifnr");var t=this.onDataHora();var a=t[0].substring(0,2)+t[0].substring(3,5)+t[0].substring(6,11);var d=t[1].substring(0,2)+t[1].substring(3,5)+t[1].substring(6,8);if(o==e){var s=o+"."+a+"."+d}else{s=e+"."+a+"."+d}this.getModelGlobal("modelAux").setProperty("/NrPedido",s);this.getModelGlobal("modelPedido").setProperty("/NrPedido",s)},onLiberarItensPedido:function(){var e=this;var o=e.getModelGlobal("modelPedido").getData();var a=e.onValidaDataMenorAtual(o.DataLimite);var d=e.onValidaDataMenorAtual(o.DataEntrega);if(o.StatusPedido==3){sap.m.MessageBox.show("O pedido "+o.NrPedido+" não pode mais ser alterado",{icon:sap.m.MessageBox.Icon.WARNING,title:"Não Permitido",actions:[t.Action.OK]})}else if(o.Pltyp==""){sap.m.MessageBox.show("Preencher a tabela de preço!",{icon:sap.m.MessageBox.Icon.ERROR,title:"Preecher campo(s)",actions:[t.Action.OK],onClose:function(){e.byId("idTopLevelIconTabBar").setSelectedKey("tab2");e.byId("idTabelaPreco").focus();e.byId("idTabelaPreco").setValueState("Error")}})}else if(o.Werks==""){sap.m.MessageBox.show("Escolha o estabelecimento!",{icon:sap.m.MessageBox.Icon.ERROR,title:"Preecher campo(s)",actions:[t.Action.OK],onClose:function(){e.byId("idTopLevelIconTabBar").setSelectedKey("tab2");e.byId("idEstabelecimento").focus();e.byId("idEstabelecimento").setValueState("Error")}})}else if(o.Vencimento==""){sap.m.MessageBox.show("Preencher a data pagamento!",{icon:sap.m.MessageBox.Icon.ERROR,title:"Preecher campo(s)",actions:[t.Action.OK],onClose:function(){e.byId("idTopLevelIconTabBar").setSelectedKey("tab2");e.byId("idTabelaPreco").focus();e.byId("idVencimento1").setValueState("Error")}})}else if(o.DataLimite==""){sap.m.MessageBox.show("Preencher a data limite!",{icon:sap.m.MessageBox.Icon.ERROR,title:"Preecher campo(s)",actions:[t.Action.OK],onClose:function(){e.byId("idTopLevelIconTabBar").setSelectedKey("tab2");e.byId("idDataLimite").focus();e.byId("idDataLimite").setValueState("Error")}})}else if(o.TipoPedido==""){sap.m.MessageBox.show("Preencher o tipo de pedido!",{icon:sap.m.MessageBox.Icon.ERROR,title:"Preecher campo(s)",actions:[t.Action.OK],onClose:function(){e.byId("idTopLevelIconTabBar").setSelectedKey("tab2");e.byId("idTipoPedido").focus();e.byId("idTipoPedido").setValueState("Error")}})}else if(o.DataEntrega==""){sap.m.MessageBox.show("Preencher a Data de Entrega!",{icon:sap.m.MessageBox.Icon.ERROR,title:"Preecher campo(s)",actions:[t.Action.OK],onClose:function(){e.byId("idTopLevelIconTabBar").setSelectedKey("tab2");e.byId("idDataEntrega").focus();e.byId("idDataEntrega").setValueState("Error")}})}else if(o.LocalEntrega==""){sap.m.MessageBox.show("Preencher a Local de Entrega!",{icon:sap.m.MessageBox.Icon.ERROR,title:"Preecher campo(s)",actions:[t.Action.OK],onClose:function(){e.byId("idTopLevelIconTabBar").setSelectedKey("tab2");e.byId("idLocalEntrega").focus();e.byId("idLocalEntrega").setValueState("Error")}})}else if(o.Inco1==""){sap.m.MessageBox.show("Preencher o Tipo de Transporte!",{icon:sap.m.MessageBox.Icon.ERROR,title:"Preecher campo(s)",actions:[t.Action.OK],onClose:function(){e.byId("idTopLevelIconTabBar").setSelectedKey("tab2");e.byId("idTipoTransporte").focus();e.byId("idTipoTransporte").setValueState("Error")}})}else if(a!="Data OK"){sap.m.MessageBox.show("Data Limite é menor que data Atual!",{icon:sap.m.MessageBox.Icon.ERROR,title:"Error campo(s)",actions:[t.Action.OK],onClose:function(){e.byId("idTopLevelIconTabBar").setSelectedKey("tab2");e.byId("idDataLimite").focus();e.byId("idDataLimite").setValueState("Error")}})}else if(d!="Data OK"){sap.m.MessageBox.show("Data de Entrega é menor que data Atual!",{icon:sap.m.MessageBox.Icon.ERROR,title:"Preecher campo(s)",actions:[t.Action.OK],onClose:function(){e.byId("idTopLevelIconTabBar").setSelectedKey("tab2");e.byId("idDataEntrega").focus();e.byId("idDataEntrega").setValueState("Error")}})}else if(o.EmailCliente==""){sap.m.MessageBox.show("Preencher o email do cliente!",{icon:sap.m.MessageBox.Icon.ERROR,title:"Preecher campo(s)",actions:[t.Action.OK],onClose:function(){e.byId("idTopLevelIconTabBar").setSelectedKey("tab2");e.byId("idEmailCliente").focus();e.byId("idEmailCliente").setValueState("Error")}})}else if(o.PedidoOrigem==""){sap.m.MessageBox.show("Preencher o pedido origem cliente!",{icon:sap.m.MessageBox.Icon.ERROR,title:"Preecher campo(s)",actions:[t.Action.OK],onClose:function(){e.byId("idTopLevelIconTabBar").setSelectedKey("tab2");e.byId("idPedidoOrigem").focus();e.byId("idPedidoOrigem").setValueState("Error")}})}else{sap.m.MessageBox.show("O tipo de frete escolhido é "+o.Inco1+". Deseja continuar?",{icon:sap.m.MessageBox.Icon.WARNING,title:"Confirmação de campo(s)",actions:[t.Action.YES,t.Action.CANCEL],onClose:function(a){if(a==t.Action.YES){e.onLimparValueState("None");o.Completo=false;o.Usuario=e.getModelGlobal("modelAux").getProperty("/CodRepres");e.byId("idPedidoDetalhe").setBusy(true);o=e.onFormatNumberPedido(o);delete o.__metadata;e.oModel.create("/P_PedidoPR",o,{method:"POST",success:function(o){t.show("Pedido: "+o.NrPedido+" Salvo!",{icon:t.Icon.SUCCESS,title:"Inclusão do Pedido!",actions:[t.Action.OK],onClose:function(){e.byId("idPedidoDetalhe").setBusy(false);e.onLiberarAbas()}})},error:function(o){e.byId("table_pedidos").setBusy(false);e.byId("idPedidoDetalhe").setBusy(false);e.onMensagemErroODATA(o);sap.ui.core.UIComponent.getRouterFor(e).navTo("pedido")}})}}})}},onLimparValueState:function(e){this.byId("idVencimento1").setValueState(e);this.byId("idEstabelecimento").setValueState(e);this.byId("idTabelaPreco").setValueState(e);this.byId("idDataLimite").setValueState(e);this.byId("idDataEntrega").setValueState(e);this.byId("idTipoPedido").setValueState(e);this.byId("idLocalEntrega").setValueState(e);this.byId("idTipoTransporte").setValueState(e);this.byId("idEmailCliente").setValueState(e);this.byId("idPedidoOrigem").setValueState(e)},onLiberarAbas:function(e){this.byId("tabTotalStep").setEnabled(true);this.byId("tabDescontoStep").setEnabled(true);this.byId("tabItensPedidoStep").setEnabled(true);this.byId("idTopLevelIconTabBar").setSelectedKey("tab3");this.getModelGlobal("modelAux").setProperty("/ObrigaSalvar",false)},onOcultarCampos:function(e){this.byId("idContrato").setVisible(e)},onChangeMsg1:function(e){this.vetorMsgPedido2=[];var o=e.getSource().getSelectedKey();var t=this.getModel("modelMsgPedido").getData();for(var a=0;a<t.length;a++){if(t[a].CodMensagem!=o){this.vetorMsgPedido2.push(t[a])}}this.getModel("modelMsgPedido2").setData(this.vetorMsgPedido2);this.getModelGlobal("modelPedido").setProperty("/MsgPedido2","");this.getModelGlobal("modelPedido").setProperty("/MsgPedido3","");this.getModelGlobal("modelAux").setProperty("/ObrigaSalvar",true)},onChangeMsg2:function(e){this.vetorMsgPedido3=[];var o=e.getSource().getSelectedKey();var t=this.getModel("modelMsgPedido2").getData();for(var a=0;a<t.length;a++){if(t[a].CodMensagem!=o){this.vetorMsgPedido3.push(t[a])}}this.getModel("modelMsgPedido3").setData(this.vetorMsgPedido3);this.getModelGlobal("modelPedido").setProperty("/MsgPedido3","");this.getModelGlobal("modelAux").setProperty("/ObrigaSalvar",true)},onChangeMsg3:function(e){this.getModelGlobal("modelAux").setProperty("/ObrigaSalvar",true)},onCriarModelPedido:function(){var e=this.onDataHora();var t=e[2].dia+"/"+e[2].mes+"/"+e[2].ano;var a=new o({NrPedido:"",Vencimento:"",IndiceFinal:"",Lifnr:"",Usuario:"",DataIni:"",HoraIni:"",DataFim:"",HoraFim:"",IdStatusPedido:"",SituacaoPedido:"",Werks:"",Bukrs:"",RegCentro:"",Pltyp:"",Inco1:"",TipoPedido:"",Completo:false,Kunnr:"",RegCliente:"",DataLimite:t,DataEntregaSujerida:t,DataEntrega:"",LocalEntrega:"",MsgPedido1:"",MsgPedido2:"",MsgPedido3:"",EmailRepres:"",EmailCliente:"",EnviarEmailCliente:true,EnviarEmailRepres:true,ValorTotal:0,TotalItens:0,ValTotItemSt:0,PesoBruto:0,PesoLiq:0,RentTotal:0,RentTotalImg:"./img/N.png",ValMinPed:0,PercAcresc:0,PercCampFlex:0,PercFator:0,PercRentabNeg:0,NrMesina:0,PercIncent:0,LogVerbaRentNeg:false,LogProposta:false,TotalVerba:0,ObsPedido:"",PedidoOrigem:"",Contrato:"",TipoIntegrBol:"",MotivoDescNota:"",MotivoDescCamp:"",MotivoDescBoleto1:"",MotivoDescBoleto2:"",Gerencia:"",Supervisor:"",ValDescDisp:0,ValDescAplicar:0,ValDescAplicarBol:0,ValDescCampInform:0,ValDescCampInformBol:0,ValDescCampDispBol:0,ValDescCampDisp:0,Vbeln:"",Email:"",Tdt:"",DataEnvio:"",HoraEnvio:"",LeadTime:0});this.setModelGlobal(a,"modelPedido")},onChangeEstabelecimento:function(e){var o=this;o.vetorTipoPedidos=[];o.vetorVencimentos=[];var t=o.getModelGlobal("modelPedido").getProperty("/Werks");o.getModelGlobal("modelPedido").setProperty("/Vencimento","");o.getModelGlobal("modelPedido").setProperty("/IndiceFinal",0);o.getModelGlobal("modelPedido").setProperty("/Contrato","");o.byId("idVencimento1").setEnabled(true);o.getModelGlobal("modelAux").setProperty("/ObrigaSalvar",true);o.onCarregarTipoPedido(t);for(var a=0;a<o.vetorCentros.length;a++){if(o.vetorCentros[a].Werks==t){o.getModelGlobal("modelPedido").setProperty("/Bukrs",o.vetorCentros[a].Bukrs);o.getModelGlobal("modelPedido").setProperty("/RegCentro",o.vetorCentros[a].Regio);var d=o.getModel("modelCliente").getProperty("/Txjcd").substring(0,3).trim();o.getModel("modelPedido").setProperty("/RegCliente",d);o.getModelGlobal("modelPedido").setProperty("/ValMinPed",o.vetorCentros[a].ValMinPed);o.getModelGlobal("modelPedido").setProperty("/PercAcresc",o.vetorCentros[a].PercAcresc);o.getModelGlobal("modelPedido").setProperty("/NrMesina",o.vetorCentros[a].NrMesina);o.getModelGlobal("modelPedido").setProperty("/PercIncent",o.vetorCentros[a].PercIncent);o.getModelGlobal("modelPedido").setProperty("/PercFator",o.vetorCentros[a].PercFator);o.getModelGlobal("modelPedido").setProperty("/PercRentabNeg",o.vetorCentros[a].PercRentabNeg);o.getModelGlobal("modelPedido").setProperty("/LogVerbaRentNeg",o.vetorCentros[a].LogVerbaRentNeg);o.getModelGlobal("modelPedido").setProperty("/LogProposta",o.vetorCentros[a].LogProposta);o.getModelGlobal("modelPedido").setProperty("/Gerencia",o.vetorCentros[a].Gerencia);o.getModelGlobal("modelPedido").setProperty("/Supervisor",o.vetorCentros[a].Supervisor);break}if(this.getModel("modelLocaisEntregas").getData().length==1){this.getModel("modelPedido").setProperty("/LocalEntrega",this.getModel("modelLocaisEntregas").getData()[0].Addrnumber)}if(this.getModel("modelTipoPedidos").getData().length==1){this.getModel("modelPedido").setProperty("/TipoPedido",this.getModel("modelTipoPedidos").getData()[0].TipoPedido)}}new Promise(function(e,t){o.byId("idVencimento1").setEnabled(true);o.byId("idContrato").setBusy(true);o.byId("idVencimento1").setBusy(true);o.oModel.read("/P_ContratoR(IvBukrs='"+o.getModel("modelPedido").getProperty("/Bukrs")+"',IvKvgr4='"+o.getModel("modelPedido").getProperty("/Kvgr4")+"')",{success:function(t){o.byId("idContrato").setBusy(false);o.byId("idVencimento1").setBusy(false);var d=o.getModel("modelVencimentos1").getData();var s=[];if(t.ContratoInterno!=""){var i="false";var r=0;for(var l=0;l<d.length;l++){if(d[l].Zterm==t.Zterm){i="true";if(String(t.AtlOrdem)=="true"){o.getModel("modelPedido").setProperty("/IndiceFinal",t.IndiceContrato)}else{o.getModel("modelPedido").setProperty("/IndiceFinal",d[a].Kbetr)}break}}if(i=="false"){var n={Zterm:t.Zterm,IdVencimento:t.Zterm,DescCond:t.DescCond};s.push(n);o.getModel("modelVencimentos1").setData(s);if(String(t.AtlOrdem)=="true"){o.getModel("modelPedido").setProperty("/IndiceFinal",t.IndiceContrato)}else{o.getModel("modelPedido").setProperty("/IndiceFinal",0)}}if(o.getModel("modelPedido").getProperty("/Vencimento")==""){o.byId("idVencimento1").setEnabled(true)}else{o.byId("idVencimento1").setEnabled(false)}o.getModelGlobal("modelPedido").setProperty("/Vencimento",t.Zterm);o.getModelGlobal("modelPedido").setProperty("/Contrato",t.ContratoInterno);o.byId("idVencimento1").setEnabled(false)}else{o.getModel("modelVencimentos1").setData(o.vetorVencimentoTotal)}e()},error:function(e){o.onMensagemErroODATA(e);t()}})}).then(function(e){new Promise(function(e,t){o.byId("idDataEntregaSujerida").setBusy(true);var a="";var d=new Date;Date.prototype.addDays=function(e){var o=new Date(this.valueOf());o.setDate(o.getDate()+parseInt(e,10));return o.toLocaleDateString("pt-BR")};var s=o.getModelGlobal("modelPedido").getProperty("/Txjcd").replace(" ","_");o.oModel.read("/P_LeadTimeR(IvBukrs='"+o.getModel("modelPedido").getProperty("/Bukrs")+"',IvRegCliente='"+o.getModelGlobal("modelPedido").getProperty("/RegCliente")+"',IvRegCentro='"+o.getModelGlobal("modelPedido").getProperty("/RegCentro")+"',IvTxjcd='"+s+"')",{success:function(t){var s=t.Kbetr;o.getModel("modelPedido").setProperty("/LeadTime",s);a=d.addDays(s);o.getModel("modelPedido").setProperty("/DataEntregaSujerida",a);o.byId("idDataEntregaSujerida").setBusy(false);e()},error:function(e){t();o.onMensagemErroODATA(e)}})}).then(function(e){o.oModel.read("/TipoIntegraBol",{urlParameters:{$filter:"IvUsuario eq '"+o.Usuario+"'"},success:function(e){var t=e.results;var a=o.getModel("modelCliente").getProperty("/Kunnr");var d=o.getModel("modelPedido").getProperty("/Bukrs");var s="false";for(var i=0;i<t.length;i++){if(a==t[i].Kunnr&&d==t[i].Bukrs){s="true";break}}if(s=="true"){o.getModelGlobal("modelPedido").setProperty("/TipoIntegrBol","CONTAS A RECEBER")}else{o.getModelGlobal("modelPedido").setProperty("/TipoIntegrBol","CONTAS A PAGAR")}},error:function(e){o.onMensagemErroODATA(e)}})}).catch(function(){o.byId("idDataEntregaSujerida").setBusy(false)})}).catch(function(){o.byId("idContrato").setBusy(false);o.byId("idVencimento1").setBusy(false)})},onCarregarTipoPedido:function(e){this.vetorTipoPedidos=[];var o={TipoPedido:"Normal"};this.vetorTipoPedidos.push(o);for(var t=0;t<this.vetorTipoPedidosTotal.length;t++){if(this.vetorTipoPedidosTotal[t].Werks==e){o={TipoPedido:"Proposta"};this.vetorTipoPedidos.push(o)}}this.getModel("modelTipoPedidos").setData(this.vetorTipoPedidos)},onChangeVencimento1:function(e){var o=this;var t=e.getSource().getSelectedKey();o.getModelGlobal("modelPedido").setProperty("/IndiceFinal","");for(var a=0;a<o.vetorVencimentoTotal.length;a++){if(o.vetorVencimentoTotal[a].Zterm==t){o.getModelGlobal("modelPedido").setProperty("/IndiceFinal",parseFloat(o.vetorVencimentoTotal[a].Kbetr))}}o.getModelGlobal("modelAux").setProperty("/ObrigaSalvar",true)},onChangeDataEntrega:function(e){Date.prototype.addDays=function(e){var o=new Date(this.valueOf());o.setDate(o.getDate()+parseInt(e,10));return o.toLocaleDateString("pt-BR")};Date.prototype.remDays=function(e){var o=new Date(this.valueOf());o.setDate(o.getDate()-parseInt(e-1,10));return o.toLocaleDateString("pt-BR")};this.getModelGlobal("modelAux").setProperty("/ObrigaSalvar",true);var o=this.getModelGlobal("modelPedido").getData();var t=this.myFormatterDataRevert(o.DataEntrega);var a=this.myFormatterDataRevert(o.DataEntregaSujerida);if(t>a){var d=new Date(Date.UTC(t[1].ano,t[1].mes-1,t[1].dia));var s=d.remDays(o.LeadTime);this.getModelGlobal("modelPedido").setProperty("/DataLimite",s)}else{var i=this.onDataHora();var r=i[2].dia+"/"+i[2].mes+"/"+i[2].ano;this.getModelGlobal("modelPedido").setProperty("/DataLimite",r)}},onBloqueiaPercEntrada:function(e){var o=e.getSource();this.getModelGlobal("modelAux").setProperty("/ObrigaSalvar",false);if(o.getValue()>0){this.byId("idPercEntrada").setEnabled(false);this.getModelGlobal("modelPedido").setProperty("/ValorEntradaPedido",parseFloat(o.getValue()))}else{this.byId("idPercEntrada").setEnabled(true)}},onChangeTipoNegociacao:function(e){var o=e.getSource();this.getModelGlobal("modelPedido").setProperty("/TipoNegociacao",o.getSelectedKey());this.getModelGlobal("modelAux").setProperty("/ObrigaSalvar",false)},onChangeTipoTransporte:function(e){this.getModelGlobal("modelAux").setProperty("/ObrigaSalvar",false)},onChangeDataPedido:function(){this.getModelGlobal("modelAux").setProperty("/ObrigaSalvar",false)},onResetarDadosPedido:function(){this.getModelGlobal("modelAux").setProperty("/NrPedido","");this.getModelGlobal("modelAux").setProperty("/ItensPedidoTab",0)},onDeletarItem:function(e){var o=this;var a=e.getParameter("listItem")||e.getSource();var d=a.getBindingContext("modelItensPedidoGrid").getProperty("NrPedido");var s=a.getBindingContext("modelItensPedidoGrid").getProperty("Matnr");var i=a.getBindingContext("modelItensPedidoGrid").getProperty("IdStatusPedido");if(i==3){var r="Não é possível deletar pedidos que já foram integrados!";t.error(r,{icon:t.Icon.ERROR,title:"Deleção de itens do pedido.",actions:[sap.m.MessageBox.Action.OK]})}else if(i==2){r="Reabra o pedido para realizar alterações";t.error(r,{icon:t.Icon.ERROR,title:"Deleção de itens do pedido.",actions:[sap.m.MessageBox.Action.OK]})}else{t.show("Deseja mesmo excluir o Item "+s+" ?",{icon:t.Icon.WARNING,title:"Exclusão de Pedidos",actions:[t.Action.YES,sap.m.MessageBox.Action.CANCEL],onClose:function(e){if(e==sap.m.MessageBox.Action.YES){o.byId("table_pedidos").setBusy(true);new Promise(function(e,t){o.onDeletarItemPedido(e,t,d,s)}).then(function(e){new Promise(function(e,t){o.onBuscarItensPedido(e,t,d)}).then(function(e){o.vetorItensPedido=e;o.getModelGlobal("modelItensPedidoGrid").setData(o.vetorItensPedido);o.getModelGlobal("modelItensPedidoGrid").refresh();if(o.vetorItensPedido.length==0){o.onBloquearCabecalho(true)}o.getModelGlobal("modelAux").setProperty("/ItensPedidoTab",o.vetorItensPedido.length);o.byId("table_pedidos").setBusy(false);new Promise(function(e,t){o.onBuscarPedido(d,e,t,o)}).then(function(e){o.getModelGlobal("modelPedido").setData(e);o.getModelGlobal("modelPedido").refresh()}).catch(function(e){o.byId("idPedidoDetalhe").setBusy(false);o.onMensagemErroODATA(e)})}).catch(function(e){o.byId("idPedidoDetalhe").setBusy(false);o.onMensagemErroODATA(e)})}).catch(function(e){o.byId("idPedidoDetalhe").setBusy(false);o.onMensagemErroODATA(e)})}}})}},onTablFilterEvent:function(e){var o=this;var a=e.getParameters();var d=indexedDB.open("VB_DataBase");d.onerror=function(){t.show(d.error.mensage,{icon:t.Icon.ERROR,title:"Banco não encontrado!",actions:[t.Action.OK]})};d.onsuccess=function(){var e=d.result;var a=o.getModelGlobal("modelAux").getProperty("/ObrigaSalvar");if(a==false){t.show("Salve o pedido !",{icon:t.Icon.ERROR,title:"Atenção!",actions:[t.Action.OK],onClose:function(){o.byId("idTopLevelIconTabBar").setSelectedKey("tab2");o.byId("idLiberarItens").focus()}})}}},onChangeAuditoriaObservacoes:function(e){this.getModelGlobal("modelAux").setProperty("/ObrigaSalvar",false)},onChangeInfo:function(e){this.getModelGlobal("modelAux").setProperty("/ObrigaSalvar",true)},onTabEvent:function(e){var o=this;var a=e.getParameters();var d=o.getModelGlobal("modelAux").getProperty("/ObrigaSalvar");var s=o.getModel("modelPedido").getData();if(s.IdStatusPedido==1){if(a.selectedKey=="tab3"||a.selectedKey=="tab4"||a.selectedKey=="tab5"){if(s.Pltyp==""){sap.m.MessageBox.show("Preencher a tabela de preço!",{icon:sap.m.MessageBox.Icon.ERROR,title:"Preecher campo(s)",actions:[t.Action.OK],onClose:function(){o.byId("idTopLevelIconTabBar").setSelectedKey("tab2");o.byId("idTabelaPreco").focus()}})}else if(s.Werks==""){sap.m.MessageBox.show("Escolha o estabelecimento!",{icon:sap.m.MessageBox.Icon.ERROR,title:"Preecher campo(s)",actions:[t.Action.OK],onClose:function(){o.byId("idTopLevelIconTabBar").setSelectedKey("tab2");o.byId("idTabelaPreco").focus()}})}else if(s.Vencimento==""){sap.m.MessageBox.show("Preencher a data pagamento!",{icon:sap.m.MessageBox.Icon.ERROR,title:"Preecher campo(s)",actions:[t.Action.OK],onClose:function(){o.byId("idTopLevelIconTabBar").setSelectedKey("tab2");o.byId("idTabelaPreco").focus()}})}else if(s.DataLimite==""){sap.m.MessageBox.show("Preencher a data limite!",{icon:sap.m.MessageBox.Icon.ERROR,title:"Preecher campo(s)",actions:[t.Action.OK],onClose:function(){o.byId("idTopLevelIconTabBar").setSelectedKey("tab2");o.byId("idTabelaPreco").focus()}})}else if(s.TipoPedido==""){sap.m.MessageBox.show("Preencher o tipo de pedido!",{icon:sap.m.MessageBox.Icon.ERROR,title:"Preecher campo(s)",actions:[t.Action.OK],onClose:function(){o.byId("idTopLevelIconTabBar").setSelectedKey("tab2");o.byId("idTabelaPreco").focus()}})}else if(s.DataEntrega==""){sap.m.MessageBox.show("Preencher a Data de Entrega!",{icon:sap.m.MessageBox.Icon.ERROR,title:"Preecher campo(s)",actions:[t.Action.OK],onClose:function(){o.byId("idTopLevelIconTabBar").setSelectedKey("tab2");o.byId("idTabelaPreco").focus()}})}else if(s.LocalEntrega==""){sap.m.MessageBox.show("Preencher a Local de Entrega!",{icon:sap.m.MessageBox.Icon.ERROR,title:"Preecher campo(s)",actions:[t.Action.OK],onClose:function(){o.byId("idTopLevelIconTabBar").setSelectedKey("tab2");o.byId("idTabelaPreco").focus()}})}else if(a.selectedKey=="tab3"||a.selectedKey=="tab4"||a.selectedKey=="tab5"){if(d==true){sap.m.MessageBox.show("Salve o pedido !",{icon:sap.m.MessageBox.Icon.ERROR,title:"Atenção!",actions:[t.Action.OK],onClose:function(){o.byId("idTopLevelIconTabBar").setSelectedKey("tab2")}})}else{o.getModelGlobal("modelAux").setProperty("/ItensPedidoTab",o.vetorItensPedido.length);o.onValidacoesCampanha()}}}else{}}},onValidacoesCampanha:function(){var e=this.getModel("modelPedido").getData();if(e.ValDescAplicarBol==""){e.ValDescAplicarBol=0}if(e.ValDescAplicar==""){e.ValDescAplicar=0}var o=e.ValDescDisp;var t=e.MotivoDescNota;var a=parseFloat(e.ValDescAplicar);var d=e.MotivoDescBoleto1;var s=parseFloat(e.ValDescAplicarBol);if(s+a>o){this.byId("idTopLevelIconTabBar").setSelectedKey("tab4");this.byId("idDescontoAplicar").focus();this.byId("idDescontoAplicar").setValueState("Error");this.byId("idDescontoAplicarBoleto").setValueState("Error");this.byId("idDescontoAplicar").setValueStateText("A soma dos descontos é maior que o permitido de R$ "+o);this.byId("idDescontoAplicarBoleto").setValueStateText("A soma dos descontos é maior que o permitido de R$ "+o)}else{this.byId("idDescontoAplicar").setValueState("None");this.byId("idDescontoAplicarBoleto").setValueState("None");this.byId("idDescontoAplicar").setValueStateText("");this.byId("idDescontoAplicarBoleto").setValueStateText("");if(s>0&&d==""){this.byId("idTopLevelIconTabBar").setSelectedKey("tab4");this.byId("idDescontoPedidoBoleto").focus();this.byId("idDescontoPedidoBoleto").setValueState("Error");this.byId("idDescontoPedidoBoleto").setValueStateText("Preencher o motivo de desconto!");return}else{this.byId("idDescontoPedidoBoleto").setValueStateText("");this.byId("idDescontoPedidoBoleto").setValueState("None")}if(a>0&&t==""){this.byId("idTopLevelIconTabBar").setSelectedKey("tab4");this.byId("idDescontoPedido").focus();this.byId("idDescontoPedido").setValueState("Error");this.byId("idDescontoPedido").setValueStateText("Preencher o motivo de desconto!");return}else{this.byId("idDescontoPedido").setValueState("None");this.byId("idDescontoPedido").setValueStateText("");this.byId("idDescontoPedidoBoleto").setValueState("None");this.byId("idDescontoPedidoBoleto").setValueStateText("")}}if(e.ValDescCampInform==""){e.ValDescCampInform=0}var i=e.ValDescCampDisp;var r=e.ValDescCampInform;var l=e.MotivoDescCamp;if(r>i){this.byId("idTopLevelIconTabBar").setSelectedKey("tab4");this.byId("idDescontoAplicarCamp").focus();this.byId("idDescontoAplicarCamp").setValueState("Error");this.byId("idDescontoAplicarCamp").setValueStateText("A soma dos descontos é maior que o permitido de R$ "+i);return}else{if(r>0&&l==""){this.byId("idTopLevelIconTabBar").setSelectedKey("tab4");this.byId("idDescontoPedidoCamp").focus();this.byId("idDescontoPedidoCamp").setValueState("Error");this.byId("idDescontoPedidoCamp").setValueStateText("Preencher o motivo de desconto!");return}else{this.byId("idDescontoAplicarCamp").setValueState("None");this.byId("idDescontoAplicarCamp").setValueStateText("");this.byId("idDescontoPedidoCamp").setValueState("None");this.byId("idDescontoPedidoCamp").setValueStateText("")}}if(e.ValDescCampInformBol==""){e.ValDescCampInformBol=0}var n=e.ValDescCampDispBol;var c=e.ValDescCampInformBol;var m=e.MotivoDescBoleto2;if(c>n){this.byId("idTopLevelIconTabBar").setSelectedKey("tab4");this.byId("idDescontoAplicarCampBol").focus();this.byId("idDescontoAplicarCampBol").setValueState("Error");this.byId("idDescontoAplicarCampBol").setValueStateText("A soma dos descontos é maior que o permitido de R$ "+n);return}else{if(c>0&&m==""){this.byId("idTopLevelIconTabBar").setSelectedKey("tab4");this.byId("idDescontoPedidoCampBol").focus();this.byId("idDescontoPedidoCampBol").setValueState("Error");this.byId("idDescontoPedidoCampBol").setValueStateText("Preencher o motivo de desconto!");return}else{this.byId("idDescontoPedidoCampBol").setValueStateText("");this.byId("idDescontoPedidoCampBol").setValueState("None");this.byId("idDescontoAplicarCampBol").setValueStateText("");this.byId("idDescontoAplicarCampBol").setValueState("None");console.log("Validações da Campanha estão OK!")}}},onBloquearCabecalho:function(e){this.byId("idEstabelecimento").setEnabled(e);this.byId("idTabelaPreco").setEnabled(e);this.byId("idVencimento1").setEnabled(e);this.byId("idDataLimite").setEnabled(true);this.byId("idDataEntrega").setEnabled(e);this.byId("idTipoPedido").setEnabled(e);this.byId("idLocalEntrega").setEnabled(e);this.byId("idTipoTransporte").setEnabled(e);if(status==2){this.byId("idMsg1").setEnabled(e);this.byId("idMsg2").setEnabled(e);this.byId("idMsg3").setEnabled(e);this.byId("idPedidoOrigem").setEnabled(e);this.byId("idEmailCliente").setEnabled(e);this.byId("idObservacoes").setEnabled(e)}else{this.byId("idMsg1").setEnabled(true);this.byId("idMsg2").setEnabled(true);this.byId("idMsg3").setEnabled(true);this.byId("idPedidoOrigem").setEnabled(true);this.byId("idEmailCliente").setEnabled(true);this.byId("idObservacoes").setEnabled(true)}},bloquearCampos:function(){this.byId("idEstabelecimento").setProperty("enabled",false);this.byId("idTipoPedido").setProperty("enabled",false);this.byId("idVencimento1").setProperty("enabled",false);this.byId("idVencimento2").setProperty("enabled",false);this.byId("idVencimento3").setProperty("enabled",false);this.byId("idTabelaPreco").setProperty("enabled",false);this.byId("idFormaPagamento").setProperty("enabled",false);this.byId("idTipoTransporte").setProperty("enabled",false)},desbloquearCampos:function(){this.byId("idEstabelecimento").setProperty("enabled",true);this.byId("idTipoPedido").setProperty("enabled",true);this.byId("idVencimento1").setProperty("enabled",true);this.byId("idVencimento2").setProperty("enabled",true);this.byId("idVencimento3").setProperty("enabled",true);this.byId("idTabelaPreco").setProperty("enabled",true);this.byId("idFormaPagamento").setProperty("enabled",true);this.byId("idTipoTransporte").setProperty("enabled",true)},resetarCamposTela:function(){this.byId("idNumeroPedido").setValue("");this.byId("idSituacao").setValue("");this.byId("idDataPedido").setValue("");this.byId("idTipoPedido").setSelectedKey("");this.byId("idTipoNegociacao").setSelectedKey("");this.byId("idTabelaPreco").setSelectedKey("");this.byId("idFormaPagamento").setSelectedKey("");this.byId("idTipoTransporte").setSelectedKey("");this.byId("idPrimeiraParcela").setValue("");this.byId("idQuantParcelas").setValue("");this.byId("idIntervaloParcelas").setValue("");this.byId("idValorMinimoPedido").setValue("");this.byId("idObservacoes").setText("")},onNovoItem:function(){console.log("onitempress standard");var e=this;var o=this.getModelGlobal("modelPedido").getProperty("/IdStatusPedido");var a=this.getModelGlobal("modelPedido").getProperty("/TipoPedido");e.oItemPedido=[];if(o==3){t.show("Este pedido não pode mais ser alterado",{icon:t.Icon.WARNING,title:"Não Permitido",actions:[t.Action.OK]})}else if(o==2){t.show("Reabra o pedido para realizar alterações!",{icon:t.Icon.WARNING,title:"Não Permitido",actions:[t.Action.OK]})}else{sap.ui.core.UIComponent.getRouterFor(this).navTo("pedidoDetalheItens")}},onFinalizarPedido:function(){var e=this;var o=this.getModel("modelPedido").getData();var a=e.getModel("modelItensPedidoGrid").getData().length;if(a<=0){sap.m.MessageBox.show("O pedido deve conter no mínimo 1 item.",{icon:sap.m.MessageBox.Icon.ERROR,title:"Falha ao Completar Pedido",actions:[t.Action.OK]})}else if(o.TipoPedido!=="Proposta"&&parseFloat(o.ValMinPed)>parseFloat(o.ValorTotal)){sap.m.MessageBox.show("Pedido não atingiu o valor mínimo estipulado pela empresa de R$: "+parseFloat(o.ValMinPed),{icon:sap.m.MessageBox.Icon.ERROR,title:"Falha ao Completar Pedido",actions:[t.Action.OK]})}else if(o.IdStatusPedido==3){sap.m.MessageBox.show("Este pedido não pode mais ser alterado",{icon:sap.m.MessageBox.Icon.WARNING,title:"Não Permitido",actions:[t.Action.OK]})}else{e.byId("idPedidoDetalhe").setBusy(true);var d=this.onDataHora();o.SituacaoPedido="PEND";o.IdStatusPedido=2;o.DataFim=d[0];o.HoraFim=d[1];o.Completo=true;e.onLimparValueState("None");o=e.onFormatNumberPedido(o);delete o.__metadata;e.byId("idPedidoDetalhe").setBusy(true);new Promise(function(t,a){e.onInserirPedido(o,t,a,e)}).then(function(a){if(a.TipoErro=="E"){sap.m.MessageBox.show(a.MsgErro,{icon:sap.m.MessageBox.Icon.ERROR,title:"Não Permitido",actions:[t.Action.OK]})}else{sap.m.MessageBox.show("Pedido salvo com sucesso !! \n\n Deseja enviar o pedido agora ?",{icon:sap.m.MessageBox.Icon.SUCCESS,title:"Sucesso!",actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(a){e.onResetarDadosPedido();if(a==sap.m.MessageBox.Action.NO){sap.ui.core.UIComponent.getRouterFor(e).navTo("pedido")}else{new Promise(function(t,a){o.SituacaoPedido="FIN";o.IdStatusPedido=3;o.DataFim=d[0];o.HoraFim=d[1];o.Completo=true;e.onLimparValueState("None");o=e.onFormatNumberPedido(o);delete o.__metadata;e.onInserirPedido(o,t,a,e)}).then(function(o){if(o.TipoErro=="E"){sap.m.MessageBox.show(o.MsgErro,{icon:sap.m.MessageBox.Icon.ERROR,title:"Não Permitido",actions:[t.Action.OK]})}else{sap.m.MessageBox.show("Pedido enviado com sucesso !!",{icon:sap.m.MessageBox.Icon.SUCCESS,title:"Sucesso!",actions:["OK"],onClose:function(o){sap.ui.core.UIComponent.getRouterFor(e).navTo("pedido");e.byId("idPedidoDetalhe").setBusy(false);e.onLiberarAbas()}})}}).catch(function(o){e.byId("idPedidoDetalhe").setBusy(false);e.onMensagemErroODATA(o)})}}})}}).catch(function(o){e.byId("idPedidoDetalhe").setBusy(false);e.onMensagemErroODATA(o)})}},onAbrirTela:function(){var e=new o({table:false});this.getView().setModel(e,"modelDelay");if(this._ItemDialog){this._ItemDialog.destroy(true)}if(!this._CreateMaterialFragment){this._ItemDialog=sap.ui.xmlfragment("application.view.ItensCampanha",this);this.getView().addDependent(this._ItemDialog)}this._ItemDialog.open()},onBuscarCampanhaAtiva:function(){var e=this;var t={dialog:true};var a=new o(t);e.setModel(a,"modelDelay");e.oModel.read("/P_ItensCampQ",{urlParameters:{$filter:"EvNrPedido eq '"+e.getModel("modelPedido").getProperty("/NrPedido")+"'"},success:function(t){var a=new o(t.results);e.setModel(a,"modelItensCampanha");e.getModel("modelDelay").setProperty("/dialog",false)},error:function(o){e.getModel("modelDelay").setProperty("/dialog",false);e.onMensagemErroODATA(o)}})}})});