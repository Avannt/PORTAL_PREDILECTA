sap.ui.define(["application/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageBox","application/model/formatter","sap/ui/core/util/MockServer","sap/ui/export/library","sap/ui/export/Spreadsheet","sap/ui/model/odata/v2/ODataModel","sap/m/MessageBox"],function(e,t,o,r,a,l,i,n){"use strict";var s=[];var d=[];var p=[];var u=[];var m=[];var c=[];var g=[];var b=l.EdmType;return e.extend("application.controller.detalhesRelatorioTabelas",{onInit:function(){this.getRouter().getRoute("detalhesRelatorioTabelas").attachPatternMatched(this._onLoadFields,this)},_handleValueHelpSearch:function(e){var t=e.getSource().getValue();var o=[];var r=[new sap.ui.model.Filter("ProdutoId",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Descricao",sap.ui.model.FilterOperator.Contains,t)];var a=new sap.ui.model.Filter(r,false);o.push(a);this.byId("idProdutoRelatorio").getBinding("suggestionItems").filter(o);this.byId("idProdutoRelatorio").suggest()},onItemChange:function(e){c=[];var t=e.getSource().getValue();var o=new sap.ui.model.json.JSONModel(c);this.getOwnerComponent().setModel(o,"relatorioTabelas");for(var r=0;r<u.length;r++){if(t==u[r].ProdutoId){c.push(u[r])}}if(t==""){o=new sap.ui.model.json.JSONModel(g);this.getOwnerComponent().setModel(o,"relatorioTabelas")}else{o=new sap.ui.model.json.JSONModel(c);this.getOwnerComponent().setModel(o,"relatorioTabelas")}},createColumnConfig:function(){var e=[];e.push({label:"Material",property:"Matnr",type:b.String});e.push({label:"Descrição",property:"Maktx",type:b.String});e.push({label:"Categoria",property:"Mvgr1Text",type:b.String});e.push({label:"SubCategoria",property:"Mvgr2Text",type:b.String});e.push({label:"Família",property:"Mvgr3Text",type:b.String});e.push({label:"Pallet",property:"QntPallet",type:b.Integer});e.push({label:"CXs",property:"QntCaixa",type:b.String});e.push({label:"Preço Bruto",property:"ValPrecoVenda",type:b.Number,scale:2,delimiter:true});e.push({label:"%Canal",property:"PercCanal",type:b.Number,scale:2,delimiter:true});e.push({label:"%Promocional",property:"PercPromoMax",type:b.Number,scale:2,delimiter:true});e.push({label:"Preço Líquido",property:"ValLiqItem",type:b.Number,scale:2,delimiter:true});e.push({label:"Preço c/ST",property:"ValPrecoUnitSt",type:b.Number,scale:2,delimiter:true});e.push({label:"%ST",property:"PerSubTri",type:b.Number,scale:2,delimiter:true});e.push({label:"%Contrato",property:"PctDescContrato",type:b.Number,scale:2,delimiter:true});return e},onExport:function(){var e,t,o,r,a;if(!this._oTable){this._oTable=this.byId("idtablePrecos")}a=this._oTable;t=a.getBinding("items");e=this.createColumnConfig();var l=this.getModel("modelParametros").getData();var n="Lista_"+l.Centro+"_"+l.Cliente+"_Orig_"+l.UFOrigem+"_Dest_"+l.UFDestino+"_"+l.Frete;o={workbook:{columns:e,hierarchyLevel:"Level",context:{application:"Portal Predilecta",version:"1.00.00",title:"Relatório de Tabela de Preço",sheetName:"Lista de Preço",modifiedBy:"Administrador",metaSheetName:"Parâmetros",metainfo:[{name:"Parâmetros de Seleção",items:[{key:"Centro",value:l.Centro},{key:"UF Origem",value:l.UFOrigem},{key:"Cliente",value:l.Cliente},{key:"UF Destino",value:l.UFDestino},{key:"Canal Atuação",value:l.CanalAtuacao},{key:"Tabela de Preço",value:l.TabPreco},{key:"Vencimento",value:l.Vencimento},{key:"Índice",value:l.Indice},{key:"Tipo Transporte",value:l.Frete},{key:"Exibição",value:l.Exibicao}]}]}},dataSource:t,fileName:n,worker:false};r=new i(o);r.build().finally(function(){r.destroy()})},_onLoadFields:function(){var e=this;var o=e.getModelGlobal("modelAux").getProperty("/CodRepres");e.oModel=e.getModelGlobal("modelAux").getProperty("/DBModel");var r={Centro:e.getModelGlobal("modelTela").getProperty("/Werks"),UFOrigem:e.getModelGlobal("modelTela").getProperty("/UFOrigem"),Cliente:e.getModelGlobal("modelTela").getProperty("/Kunnr"),UFDestino:e.getModelGlobal("modelTela").getProperty("/UFDestino"),CanalAtuacao:e.getModelGlobal("modelTela").getProperty("/DescKvgr2"),TabPreco:e.getModelGlobal("modelTela").getProperty("/Pltyp"),Vencimento:e.getModelGlobal("modelTela").getProperty("/Vencimento"),Indice:e.getModelGlobal("modelTela").getProperty("/Indice"),Frete:e.getModelGlobal("modelTela").getProperty("/Inco1"),Exibicao:e.getModelGlobal("modelTela").getProperty("/Exibicao")};var a=new t(r);e.setModel(a,"modelParametros");var l=e.getModel("modelParametros").getData();e.byId("master").setBusy(true);e.oModel.read("/P_RelTabPreco",{urlParameters:{$filter:"Usuario eq '"+o+"' and Centro eq '"+l.Centro+"' and Cliente eq '"+l.Cliente+"' and TabPreco eq '"+l.TabPreco+"' and Indice eq "+l.Indice+" and Frete eq '"+l.Frete+"' and Exibicao eq '"+l.Exibicao+"'"},success:function(o){e.vetorTabPreco=o.results;e.byId("master").setBusy(false);var r=new t(e.vetorTabPreco);e.setModel(r,"modelTabPreco")},error:function(t){e.byId("master").setBusy(false);e.onMensagemErroODATA(t)}})}})});