sap.ui.define(["application/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageBox","application/model/formatter"],function(e,t,a,o){"use strict";return e.extend("application.controller.verbaConsultas",{formatter:o,onInit:function(){this.getRouter().getRoute("VerbaConsultas").attachPatternMatched(this._onLoadFields,this)},_onLoadFields:function(){var e=this;e.onInicializaModels()},onChangeEmpresa:function(){var e=this;var a=this.getModel("modelTela").getProperty("/Bukrs");e.onDialogCancelar();var o=indexedDB.open("PRED");o.onerror=function(){alert(o.error.mensage)};o.onsuccess=function(){var r=o.result;var i=r.transaction("SaldoVerbas","readwrite");var n=i.objectStore("SaldoVerbas");var s=n.index("Bukrs");var l=s.getAll(a);l.onsuccess=function(o){var r=o.target.result;if(r!==undefined){var i=[];for(var n=0;n<r.length;n++){r[n].NomEmpresa="";for(var s=0;s<e.vetorCentros.length;s++){if(e.vetorCentros[s].Bukrs==a){r[n].NomEmpresa=e.vetorCentros[s].NomeCentro;break}}i.push(r[n])}}var l=new t(i);e.setModel(l,"Verbas")};var d=r.transaction("Aux","readwrite");var u=d.objectStore("Aux");var l=u.getAll();l.onsuccess=function(a){var o=a.target.result[0];if(o!==undefined){var r=e.getModel("modelTela").getData();r.Cod=o.CodRepres;r.Nome=o.NomeRepres;r.Email=o.Email;var i=new t(r);e.setModel(i,"modelTela")}}}},onInicializaModels:function(){var e={Bukrs:"",Cod:"",Nome:"Nenhum UsuÃ¡rio selecionado",Email:""};var a=new t(e);this.setModel(a,"modelTela");var o=new t;this.setModel(o,"Verbas");var r={Bukrs:"",DatUltMovto:"",IdSaldo:"",IvUsuario:"",Lifnr:"",NomEmpresa:"",Periodo:"",Usuario:"",ValSdoCr:"",ValSdoDb:"",ValSdoFim:"",ValSdoIni:""};var i=new t(r);this.setModelGlobal(i,"modelVerba")},onAbrirCentros:function(){if(this._ItemDialog){this._ItemDialog.destroy(true)}if(!this._CreateMaterialFragment){this._ItemDialog=sap.ui.xmlfragment("application.view.centros",this);this.getView().addDependent(this._ItemDialog)}this._ItemDialog.open()},onDialogCancelar:function(){if(this._ItemDialog){this._ItemDialog.destroy(true)}},onSearch:function(e){var t=e.getSource().getValue();var a=[];var o=[new sap.ui.model.Filter("Reprs",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Name",sap.ui.model.FilterOperator.Contains,t)];var r=new sap.ui.model.Filter(o,false);a.push(r);this.byId("table_Verbas").getBinding("items").filter(a,sap.ui.model.FilterType.Application)},onItemPress:function(e){var t=e.getParameter("listItem")||e.getSource();var a=t.getBindingContext("Verbas").getObject();delete a.__metadata;this.getModelGlobal("modelVerba").setData(a);sap.ui.core.UIComponent.getRouterFor(this).navTo("verbaConsultasDetalhe")}})});