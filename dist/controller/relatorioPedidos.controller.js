sap.ui.define(["application/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageBox","application/model/formatter","sap/ui/core/util/MockServer","sap/ui/export/library","sap/ui/export/Spreadsheet","sap/ui/model/odata/v2/ODataModel","sap/m/MessageBox"],function(e,t,r,i,a,o,s,n){"use strict";var l=[];var u=o.EdmType;return e.extend("application.controller.relatorioPedidos",{onInit:function(){this.getRouter().getRoute("relatorioPedidos").attachPatternMatched(this._onLoadFields,this)},_onLoadFields:function(){var e=this;var r=e.getModelGlobal("modelAux").getProperty("/CodRepres");e.oModel=e.getModelGlobal("modelAux").getProperty("/DBModel");var i={WerksIni:"",WerksFim:"",KunnrIni:"",KunnrFim:"",Kvgr4Ini:"",Kvgr4Fim:"",Kvgr5Ini:"",Kvgr5Fim:"",VbelnIni:"",VbelnFim:"",LifnrIni:"",LifnrFim:"",MatnrIni:"",MatnrFim:"",Periodo:"",StatusAberto:true,StatusAbertoCredito:true,StatusAbertoCancel:true,StatusAtendParcial:true,StatusAtendParcialPendCred:true,StatusAtendParcialCancel:true,StatusAtendTotal:true,StatusAtendTotalCancel:true,StatusSuspenso:true,StatusCancelado:true};var a=new t(i);e.setModel(a,"modelParametros");e.vetorPedidos=[];var o=new t(e.vetorPedidos);e.setModel(o,"modelPedidos");e.vetorResumoEmpresa=[];var s=new t(e.vetorResumoEmpresa);e.setModel(s,"modelResumoEmpresa");new Promise(function(t,i){e.onBuscarClientes(r,t,i,e)}).then(function(r){var i=r;var a=[];var o=[];var s=[];for(var n=0;n<i.length;n++){var l=false;var u=false;var d=false;for(var p=0;p<a.length;p++){if(i[n].Kvgr4==a[p].Kvgr4||i[n].Kvgr4==""){l=true;break}}for(var g=0;g<o.length;g++){if(i[n].Kvgr5==o[g].Kvgr5||i[n].Kvgr5==""){u=true;break}}for(var m=0;m<s.length;m++){if(i[n].Lifnr==s[m].Lifnr||i[n].Lifnr==""){d=true;break}}if(l==false){a.push(i[n])}if(u==false){o.push(i[n])}if(d==false){s.push(i[n])}}var v=new t(i);e.setModel(v,"modelClientes");var f=new t(a);e.setModel(f,"modelRedes");var F=new t(o);e.setModel(F,"modelBandeiras");var y=new t(s);e.setModel(y,"modelRepres")}).catch(function(t){e.onMensagemErroODATA(t)});new Promise(function(t,i){e.onBuscarProdutos(r,t,i,e)}).then(function(r){var i=r;var a=[];var o=[];var s=[];var n=[];for(var l=0;l<i.length;l++){var u=false;var d=false;var p=false;var g=false;for(var m=0;m<a.length;m++){if(i[l].Mvgr1==a[m].Mvgr1||i[l].Mvgr1==""){u=true;break}}for(var v=0;v<o.length;v++){if(i[l].Mvgr2==o[v].Mvgr2||i[l].Mvgr2==""){d=true;break}}for(var f=0;f<s.length;f++){if(i[l].Mvgr3==s[f].Mvgr3||i[l].Mvgr3==""){p=true;break}}for(var F=0;F<n.length;F++){if(i[l].Mvgr5==n[F].Mvgr5||i[l].Mvgr5==""){g=true;break}}if(u==false){a.push(i[l])}if(d==false){o.push(i[l])}if(p==false){s.push(i[l])}if(g==false){n.push(i[l])}}var y=new t(i);e.setModel(y,"modelMaterial");var S=new t(a);e.setModel(S,"modelCategoria");var h=new t(o);e.setModel(h,"modelSubCategoria");var b=new t(s);e.setModel(b,"modelFamilia");var c=new t(n);e.setModel(c,"modelMarca")}).catch(function(t){e.onMensagemErroODATA(t)});e.oModel.read("/Centros",{urlParameters:{$filter:"IvUsuario eq '"+r+"'"},success:function(r){var i=r.results;var a=new t(i);e.setModel(a,"modelCentros")},error:function(t){e.onMensagemErroODATA(t)}})},ongetHeaderGroupLifnr:function(e){return e.getProperty("Lifnr")},ongetHeaderGroupBukrs:function(e){return e.getProperty("Bukrs")+" - "+e.getProperty("Butxt")},createColumnConfig:function(){var e=[];e.push({label:"Repres",property:"Lifnr",type:u.Number});e.push({label:"Nome Repres",property:"Name1Rep",type:u.String});e.push({label:"Vocativo",property:"TitleLet",type:u.String});e.push({label:"Centro",property:"Werks",type:u.String});e.push({label:"Doc.Vendas",property:"Vbeln",type:u.String});e.push({label:"Referência Cliente",property:"Bstkd",type:u.String});e.push({label:"Força Vendas",property:"Bname",type:u.String});e.push({label:"Emissão",property:"Audat",type:u.DateTime,format:"dd/mm/yyyy"});e.push({label:"Cliente",property:"Kunnr",type:u.String});e.push({label:"Razão Social",property:"Name1Cli",type:u.String});e.push({label:"CNPJ",property:"Stcd1",type:u.String});e.push({label:"CPF",property:"Stcd2",type:u.String});e.push({label:"Rede",property:"Kvgr4",type:u.String});e.push({label:"Descrição Rede",property:"Kvgr4Text",type:u.String});e.push({label:"Bandeira",property:"Kvgr5",type:u.String});e.push({label:"Descrição Bandeira",property:"Kvgr5Text",type:u.String});e.push({label:"UF",property:"Region",type:u.String});e.push({label:"Cidade",property:"City1",type:u.String});e.push({label:"Volume(CX)",property:"Kwmeng",type:u.Number,scale:2,delimiter:true});e.push({label:"Vol. Faturado(CX)",property:"Fkimg",type:u.Number,scale:2,delimiter:true});e.push({label:"Saldo Volume(CX)",property:"QtdSdoPed",type:u.Number,scale:2,delimiter:true});e.push({label:"Valor S/ST",property:"ValSSt",type:u.Number,scale:2,delimiter:true});e.push({label:"Vl Faturado S/ST",property:"ValFatSSt",type:u.Number,scale:2,delimiter:true});e.push({label:"Vl Saldo S/ST",property:"ValSdoSSt",type:u.Number,scale:2,delimiter:true});e.push({label:"Status",property:"DescStatus",type:u.String});e.push({label:"Status Recusa",property:"Abstk",type:u.String});e.push({label:"Status Crédito",property:"Cmgst",type:u.String});e.push({label:"Status Global",property:"Gbstk",type:u.String});e.push({label:"Status Global Remessa",property:"Lfgsk",type:u.String});e.push({label:"Status Remessa",property:"Lfstk",type:u.String});e.push({label:"Status Global Bloqueio",property:"Lsstk",type:u.String});return e},onExport:function(){var e,t,r,i,a;if(!this._oTable){this._oTable=this.byId("idtablePedidos")}a=this._oTable;t=a.getBinding("items");e=this.createColumnConfig();r={workbook:{columns:e,hierarchyLevel:"Level"},dataSource:t,fileName:"Rel_Posicao_Pedidos.xlsx",worker:false};i=new s(r);i.build().finally(function(){i.destroy()})},onSuggestCentroIni:function(e){var t=e.getSource().getValue();var r=[];var i=[new sap.ui.model.Filter("Werks",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("NomeCentro",sap.ui.model.FilterOperator.Contains,t)];var a=new sap.ui.model.Filter(i,false);r.push(a);this.byId("idCentroIni").getBinding("suggestionItems").filter(r);this.byId("idCentroIni").suggest()},onDialogClose:function(){if(this._ItemDialog){this._ItemDialog.destroy(true)}},onPressBtnFiltrar:function(){var e=this;var t=e.getModelGlobal("modelAux").getProperty("/CodRepres");e.oModel=e.getModelGlobal("modelAux").getProperty("/DBModel");var r=e.getModel("modelParametros").getData();var i=e.getModel("modelParametros").getProperty("/Periodo");var a=i.split(" - ");var o=a[0];var s=a[1];e.byId("master").setBusy(true);e.oModel.read("/P_RelPedidos",{urlParameters:{$filter:"Usuario eq '"+t+"' and WerksIni eq '"+r.WerksIni+"' and WerksFim eq '"+r.WerksFim+"' and KunnrIni eq '"+r.KunnrIni+"' and KunnrFim eq '"+r.KunnrFim+"' and Kvgr4Ini eq '"+r.Kvgr4Ini+"' and Kvgr4Fim eq '"+r.Kvgr4Fim+"' and Kvgr5Ini eq '"+r.Kvgr5Ini+"' and Kvgr5Fim eq '"+r.Kvgr5Fim+"' and VbelnIni eq '"+r.VbelnIni+"' and VbelnFim eq '"+r.VbelnFim+"' and RepreIni eq '"+r.LifnrIni+"' and RepreFim eq '"+r.LifnrFim+"' and MatnrIni eq '"+r.MatnrIni+"' and MatnrFim eq '"+r.MatnrFim+"' and PerioIni eq '"+o+"' and PerioFim eq '"+s+"'"},success:function(t){e.vetorPedidos=[];e.vetorPedidosAux=t.results;for(var i=0;i<e.vetorPedidosAux.length;i++){if(e.vetorPedidosAux[i].Status=="A"&&r.StatusAberto==true||e.vetorPedidosAux[i].Status=="B"&&r.StatusAbertoCredito==true||e.vetorPedidosAux[i].Status=="C"&&r.StatusAbertoCancel==true||e.vetorPedidosAux[i].Status=="D"&&r.StatusAtendParcial==true||e.vetorPedidosAux[i].Status=="E"&&r.StatusAtendParcialPendCred==true||e.vetorPedidosAux[i].Status=="F"&&r.StatusAtendParcialCancel==true||e.vetorPedidosAux[i].Status=="G"&&r.StatusAtendTotal==true||e.vetorPedidosAux[i].Status=="H"&&r.StatusAtendTotalCancel==true||e.vetorPedidosAux[i].Status=="I"&&r.StatusSuspenso==true||e.vetorPedidosAux[i].Status=="J"&&r.StatusCancelado==true){e.vetorPedidos.push(e.vetorPedidosAux[i])}}e.getModel("modelPedidos").setData(e.vetorPedidos);e.byId("master").setBusy(false)},error:function(t){e.byId("master").setBusy(false);e.onMensagemErroODATA(t)}})},onExpandFiltro:function(){if(this.byId("idPanelFiltro").getExpanded()){this.byId("idPanelFiltro").setHeaderText("Ocultar Filtros")}else{this.byId("idPanelFiltro").setHeaderText("Exibir Filtros")}},onSuggestCentroFim:function(e){var t=e.getSource().getValue();var r=[];var i=[new sap.ui.model.Filter("Werks",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("NomeCentro",sap.ui.model.FilterOperator.Contains,t)];var a=new sap.ui.model.Filter(i,false);r.push(a);this.byId("idCentroFim").getBinding("suggestionItems").filter(r);this.byId("idCentroFim").suggest()},onSuggestClienteIni:function(e){var t=e.getSource().getValue();var r=[];var i=[new sap.ui.model.Filter("Kunnr",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Name1",sap.ui.model.FilterOperator.Contains,t)];var a=new sap.ui.model.Filter(i,false);r.push(a);this.byId("idClienteIni").getBinding("suggestionItems").filter(r);this.byId("idClienteIni").suggest()},onSuggestClienteFim:function(e){var t=e.getSource().getValue();var r=[];var i=[new sap.ui.model.Filter("Kunnr",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Name1",sap.ui.model.FilterOperator.Contains,t)];var a=new sap.ui.model.Filter(i,false);r.push(a);this.byId("idClienteFim").getBinding("suggestionItems").filter(r);this.byId("idClienteFim").suggest()},onSuggestRedeIni:function(e){var t=e.getSource().getValue();var r=[];var i=[new sap.ui.model.Filter("Kvgr4",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("DescKvgr4",sap.ui.model.FilterOperator.Contains,t)];var a=new sap.ui.model.Filter(i,false);r.push(a);this.byId("idRedeIni").getBinding("suggestionItems").filter(r);this.byId("idRedeIni").suggest()},onSuggestRedeFim:function(e){var t=e.getSource().getValue();var r=[];var i=[new sap.ui.model.Filter("Kvgr4",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("DescKvgr4",sap.ui.model.FilterOperator.Contains,t)];var a=new sap.ui.model.Filter(i,false);r.push(a);this.byId("idRedeFim").getBinding("suggestionItems").filter(r);this.byId("idRedeFim").suggest()},onSuggestBandeiraIni:function(e){var t=e.getSource().getValue();var r=[];var i=[new sap.ui.model.Filter("Kvgr5",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("DescKvgr5",sap.ui.model.FilterOperator.Contains,t)];var a=new sap.ui.model.Filter(i,false);r.push(a);this.byId("idBandeiraIni").getBinding("suggestionItems").filter(r);this.byId("idBandeiraIni").suggest()},onSuggestBandeiraFim:function(e){var t=e.getSource().getValue();var r=[];var i=[new sap.ui.model.Filter("Kvgr5",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("DescKvgr5",sap.ui.model.FilterOperator.Contains,t)];var a=new sap.ui.model.Filter(i,false);r.push(a);this.byId("idBandeiraFim").getBinding("suggestionItems").filter(r);this.byId("idBandeiraFim").suggest()},onSuggestRepresIni:function(e){var t=e.getSource().getValue();var r=[];var i=[new sap.ui.model.Filter("Lifnr",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Name1Rep",sap.ui.model.FilterOperator.Contains,t)];var a=new sap.ui.model.Filter(i,false);r.push(a);this.byId("idRepreIni").getBinding("suggestionItems").filter(r);this.byId("idRepreIni").suggest()},onSuggestRepresFim:function(e){var t=e.getSource().getValue();var r=[];var i=[new sap.ui.model.Filter("Lifnr",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Name1Rep",sap.ui.model.FilterOperator.Contains,t)];var a=new sap.ui.model.Filter(i,false);r.push(a);this.byId("idRepreFim").getBinding("suggestionItems").filter(r);this.byId("idRepreFim").suggest()},onSuggestMaterialIni:function(e){var t=e.getSource().getValue();var r=[];var i=[new sap.ui.model.Filter("Matnr",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Maktx",sap.ui.model.FilterOperator.Contains,t)];var a=new sap.ui.model.Filter(i,false);r.push(a);this.byId("idMaterialIni").getBinding("suggestionItems").filter(r);this.byId("idMaterialIni").suggest()},onSuggestMaterialFim:function(e){var t=e.getSource().getValue();var r=[];var i=[new sap.ui.model.Filter("Matnr",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Maktx",sap.ui.model.FilterOperator.Contains,t)];var a=new sap.ui.model.Filter(i,false);r.push(a);this.byId("idMaterialFim").getBinding("suggestionItems").filter(r);this.byId("idMaterialFim").suggest()}})});